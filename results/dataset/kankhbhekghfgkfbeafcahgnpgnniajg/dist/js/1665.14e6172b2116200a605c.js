(self.webpackChunknewtab=self.webpackChunknewtab||[]).push([[1665],{3709:t=>{t.exports='<div class="modalbox"> <div class="modalbox-header"></div> <div class="modalbox-content"></div> </div>'},1665:(t,e,i)=>{"use strict";i.r(e),i.d(e,{WidgetBase:()=>u});var s=i(5996),o=i(8051),n=i(4371),a=i(1961),h=i(9405);const r="normal",l="max",d="mini",p="fold";class c{constructor(t={}){this.options={id:null,width:"500px",height:null,position:"fixed",zIndex:1e4,headerText:"",headerTextClass:"",moveInHeaderControlbar:!1,showHeader:!0,showHeaderControlbar:!0,showHeaderControlbarFold:!1,showHeaderControlbarMini:!1,showHeaderControlbarMax:!1,showHeaderControlbarClose:!0,appendHeaderControlBar:()=>{},content:null,draggable:!0,draggableOptions:{zIndex:1e4},resizable:!1,resizableOptions:{},status:r,overlay:!1,overlayCloseClick:!0,overlayClass:"",containerClass:"",headerClass:"",contentClass:"",headerControlbarClass:"",elParent:null,onOpen:t=>{},onClose:t=>{},escDisable:!1,x:null,y:null},this.headerHeight=0,this.plugins={draggable:null,resizable:null},this.options=Object.assign(this.options,t),this.id="__modal_"+(new Date).getTime(),this.options.id&&(this.id=this.options.id);const e=document.createElement("div");if(e.innerHTML=i(3709),this.container=e.firstChild,this.container.setAttribute("id",this.id),this.options.containerClass&&this.container.classList.add(this.options.containerClass),this.header=this.container.querySelector(".modalbox-header"),this.header.setAttribute("data-target",this.id),this.options.headerClass&&this.header.classList.add(this.options.headerClass),this.content=this.container.querySelector(".modalbox-content"),this.options.contentClass&&this.content.classList.add(this.options.contentClass),this.options.overlay&&(this.overlay=document.createElement("div"),this.overlay.classList.add("modalbox-overlay"),this.options.overlayClass&&this.overlay.classList.add(this.options.overlayClass),this.options.overlayCloseClick&&this.overlay.addEventListener("mousedown",(()=>{this.close()}))),this.headerText=document.createElement("div"),this.headerText.textContent=this.options.headerText,this.headerText.classList.add("modalbox-header-text"),this.options.headerTextClass&&this.headerText.classList.add(this.options.headerTextClass),this.header.append(this.headerText),this.options.showHeaderControlbar){if(this.options.moveInHeaderControlbar&&this.container.classList.add("movein"),this.headerControlbar=document.createElement("div"),this.headerControlbar.classList.add("modalbox-header-controlbar"),this.headerControlbar.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation()})),this.options.headerControlbarClass&&this.headerControlbar.classList.add(this.options.headerControlbarClass),this.options.appendHeaderControlBar(this),this.options.showHeaderControlbarFold&&(this.foldBtn=document.createElement("button"),this.foldBtn.setAttribute("class","controlbar-fold"),this.foldBtn.textContent="^",this.foldBtn.addEventListener("click",(()=>{this.fold()})),this.headerControlbar.append(this.foldBtn)),this.options.showHeaderControlbarMini&&(this.miniBtn=document.createElement("button"),this.miniBtn.setAttribute("class","controlbar-mini"),this.miniBtn.textContent="-",this.miniBtn.addEventListener("click",(()=>{this.mini()})),this.headerControlbar.append(this.miniBtn),this.miniBox=document.createElement("div"),this.miniBox.setAttribute("id",this.id+"_modalbox-mini"),this.miniBox.className="modalbox-mini",document.body.append(this.miniBox)),this.options.showHeaderControlbarMax&&(this.maxBtn=document.createElement("button"),this.maxBtn.setAttribute("class","controlbar-max"),this.maxBtn.textContent="[]",this.maxBtn.addEventListener("click",(()=>{this.max()})),this.headerControlbar.append(this.maxBtn)),this.options.showHeaderControlbarClose){this.closeBtn=document.createElement("i"),this.closeBtn.setAttribute("class","controlbar-close");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","icon"),t.setAttribute("viewBox","0 0 1024 1024"),t.setAttribute("version","1.1"),t.setAttribute("width",24),t.setAttribute("height",24);const e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("d","M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z"),e.setAttribute("fill","#ffffff"),t.appendChild(e),this.closeBtn.appendChild(t),this.closeBtn.addEventListener("click",(()=>{this.close()})),this.headerControlbar.append(this.closeBtn)}this.header.append(this.headerControlbar)}this.options.showHeader||this.hideHeader(),this.options.elParent?this.options.elParent.append(this.container):document.body.append(this.container),this.open(),this.headerHeight=this.header.offsetHeight,this.overlay&&document.body.append(this.overlay),null!==this.options.content&&this.setContent(this.options.content);let s=this.options.width?"width:"+this.options.width+";":"",o=this.options.height?"height:"+this.options.height+";":"";this.container.style.cssText=`${s}${o}`;let n=this.options.x,a=this.options.y;if(null===this.options.x){let t=window.innerWidth/2-this.container.offsetWidth/2;n=(100*parseFloat(t/window.innerWidth)).toFixed(2)+"vw",this.options.x=t+"vw"}if(null===this.options.y){let t=window.innerHeight/2-this.container.offsetHeight/2;a=(100*parseFloat(t/window.innerHeight)).toFixed(2)+"vh",this.options.y=t+"vh"}switch(this.container.style.cssText+=`left:${n}; top:${a};`,this.container.style.position=this.options.position,this.container.style.zIndex=this.options.zIndex,this.options.status){case d:this.mini(!0);break;case l:this.max(!0);break;case p:this.fold(!0)}if(this.options.draggable){let t=()=>{};"function"==typeof this.options.draggableOptions.onUp&&(t=this.options.draggableOptions.onUp),this.options.draggableOptions.onUp=(e,i)=>{this._onUp(e),t(e,i)},this.setDraggable()}if(this.options.resizable){let t=()=>{};"function"==typeof this.options.resizableOptions.onUp&&(t=this.options.resizableOptions.onUp),this.options.resizableOptions.onUp=(e,i)=>{this._onUp(e),t(e,i)},this.setResizable()}}_onUp(t){const e=t.getBoundingClientRect();let i=(100*parseFloat(e.x/window.innerWidth)).toFixed(2)+"vw",s=(100*parseFloat(e.y/window.innerHeight)).toFixed(2)+"vh",o=(100*parseFloat(e.width/window.innerWidth)).toFixed(2)+"vw",n=(100*parseFloat(e.height/window.innerHeight)).toFixed(2)+"vh";return t.style.left=i,t.style.top=s,t.style.width=o,t.style.height=n,!0}setDraggable(){this.header.style.cursor="move",i.e(1900).then(i.bind(i,1900)).then((t=>{this.options.draggableOptions.selector=this.header,this.plugins.draggable=new t.Draggable(this.options.draggableOptions)}))}setResizable(){i.e(1510).then(i.bind(i,1510)).then((t=>{this.options.resizableOptions.selector=this.container,this.plugins.resizable=new t.Resizable(this.options.resizableOptions)}))}setContent(t){"string"==typeof t?this.content.textContent=t:this.content.appendChild(t)}max(t){if(this.options.status!=l||t){this.container.setAttribute("data-width",this.container.offsetWidth),this.container.setAttribute("data-height",this.container.offsetHeight),this.options.y=this.container.offsetTop,this.options.x=this.container.offsetLeft,this.options.status=l;let t="top:0; left:0; right: 0; bottom: 0; width:100%;height:100%;";this.container.style.cssText=t}else{this.content.style.display="block",this.options.status=r;let t=this.container.getAttribute("data-width"),e=this.container.getAttribute("data-height"),i=`top:${this.options.y}px; left:${this.options.x}px;`;t&&(i+=`width:${t}px;`),e&&(i+=`height:${e}px;`),this.container.style.cssText=i}}fold(t){if(this.options.status!=p||t)this.options.status=p,this.container.setAttribute("data-height-fold",this.container.offsetHeight),this.content.style.display="none",this.container.style.height=`${this.headerHeight}px`;else{this.options.status=r,this.content.style.display="block";let t=this.container.getAttribute("data-height-fold");this.container.style.height=`${t}px`}}mini(t){this.options.status!=d||t?(this.options.status=d,this.container.style.display="none",this.miniBox.append(this.header)):(this.options.status=r,this.container.style.display="block",this.container.prepend(this.header))}open(){const t=e=>{this.options.escDisable||27==e.keyCode&&(this.close(),document.removeEventListener("keyup",t))};document.addEventListener("keyup",t),this.options.onOpen(this.container),this.container.style.display="block",this.overlay&&(this.overlay.style.display="block")}close(){this.options.onClose(this.container),this.container.style.display="none",this.overlay&&(this.overlay.style.display="none")}showHeader(){this.header.style.display="block"}hideHeader(){this.header.style.display="none"}}class u extends s.Z{constructor(t={}){super(),this.id=null,this.type=null,this.w=null,this.h=null,this.y=null,this.x=null,this.page="",this.popup=null,this.settingPopup=null,this.attrs=null,this.setParams(t)}openPopup(t={},e=null,i=null,s="#eeeeee"){let n=!1;if(this.popup)this.popup.open();else{let r={id:this.id,width:this.w?this.w+"vw":null,height:this.h?this.h+"vh":null,x:this.x?this.x+"vw":null,y:this.y?this.y+"vh":null,position:this.x?"fixed":null,content:"",overlay:!1,overlayCloseClick:!1,draggable:!0,draggableOptions:{onMove:()=>{n=!0},onUp:(t,e)=>{n&&(this.setPosition(),this.update(),n=!1)},inElement:document.body},resizable:!0,resizableOptions:{onMove:()=>{n=!0},onUp:(t,e)=>{n&&(this.setPosition(),this.update(),n=!1)}},moveInHeaderControlbar:!1,showHeaderControlbarClose:!1,elParent:null,headerText:"",escDisable:!0,containerClass:"widget-modalbox",appendHeaderControlBar:t=>{let i=document.createElement("i");i.setAttribute("class","widget-setting-btn rounded-circle"),i.setAttribute("data-toggle","dropdown");const n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("version","1.1"),n.setAttribute("width",24),n.setAttribute("height",24),n.setAttribute("fill",s);const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("d","M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"),n.appendChild(r),i.appendChild(n),t.headerControlbar.append(i);let l=document.createElement("div");l.setAttribute("class","dropdown-menu"),l.style.cursor="pointer","function"==typeof e&&e(l,t);let d=document.createElement("div");d.setAttribute("class","dropdown-item move"),d.setAttribute("data-action","move"),d.textContent=o.X.locale.get("move_to");let p=document.createElement("div");p.setAttribute("class","move-to rounded-right"),d.appendChild(p),l.append(d);let c=document.createElement("a");c.setAttribute("class","dropdown-item"),c.textContent=o.X.locale.get("remove"),l.append(c),c.addEventListener("click",(()=>{this.popup.container.remove(),this.popup.overlay&&this.popup.overlay.remove(),this.delete()})),t.headerControlbar.append(l),i.addEventListener("click",(()=>{const t=document.querySelector("#page-item");p.textContent="";const e=t.querySelector("li.active").getAttribute("data-to"),i=t.querySelectorAll("li");let s=i.length;for(let t=0;t<i.length;t++){let o=i[t],n=o.getAttribute("data-to");if(n==e)continue;if("none"===window.getComputedStyle(o).display){s--;continue}let r=document.createElement("div");r.setAttribute("data-to",n),r.textContent=o.querySelector("span").textContent,r.addEventListener("click",(()=>{document.querySelector("#page-main #p-"+n+" .widgets-box").append(this.popup.container),this.page=n,this.dataSync((()=>{let t=h.Z.getWidget(e,this.id);return t.page=n,h.Z.deleteWidget(e,this.id),h.Z.updateWidget(t),!0}),(()=>{let t=a.Z.get("widget","moveToPage");return this.request({method:t.method,url:t.url,params:{pageId:n,id:this.id}}),!0}))})),p.append(r)}d.style.display=1==s?"none":"block"}))}};r=Object.assign(r,t),i&&(r.resizableOptions.position=i),this.popup=new c(r)}}setParams(t){for(let e in t)"type"!=e&&null!=t[e]&&this.hasOwnProperty(e)&&(this[e]=t[e]);this.id||(this.id=(0,n.createId)(this.type,8))}setPosition(){const t=document.getElementById(this.id);if(!t)return;const e=t.getBoundingClientRect();this.w=parseFloat((100*parseFloat(e.width/window.innerWidth)).toFixed(2)),this.h=parseFloat((100*parseFloat(e.height/window.innerHeight)).toFixed(2)),this.x=parseFloat((100*parseFloat(e.x/window.innerWidth)).toFixed(2)),this.y=parseFloat((100*parseFloat(e.y/window.innerHeight)).toFixed(2))}insert(t){let e={type:this.type,w:this.w,h:this.h,x:this.x,y:this.y,page:this.page,attrs:this.attrs};this.dataSync((()=>(e.id=this.id,h.Z.updateWidget(e),!0)),(async()=>{let i=a.Z.get("widget","insert"),s=await this.request({method:i.method,url:i.url,params:e});return this.id=s.data,"function"==typeof t&&t(),!0}))}update(){let t={id:this.id,w:this.w,h:this.h,x:this.x,y:this.y,page:this.page,attrs:this.attrs};this.dataSync((()=>(h.Z.updateWidget(t),!0)),(()=>{let e=a.Z.get("widget","update");return this.request({method:e.method,url:e.url,params:t}),!0}))}delete(){this.dataSync((()=>(h.Z.deleteWidget(this.page,this.id),!0)),(()=>{let t=a.Z.get("widget","delete");return this.request({method:t.method,url:t.url,params:{id:this.id}}),!0}))}}}}]);