(self.webpackChunknewtab=self.webpackChunknewtab||[]).push([[1961],{2004:(t,e,i)=>{"use strict";i.r(e),i.d(e,{AutoComplete:()=>n}),i(8051);var s=i(2889);class n{constructor(t={}){this.options={input:null,requestUri:"",requestParams:{},requestParamsKey:"q",containerClass:"__autocomplete-seg-list",iconClearClass:"__autocomplete-icon-clear",itemClass:"__autocomplete-seg-item",iconClearStyle:{},containerStyle:{},parseRes:t=>t,parseItem:t=>{},onClick:(t,e)=>{},onRequst:t=>{},onClickClear:()=>{},firstSelected:!0,delay:300},this.options=Object.assign(this.options,t),this.iconClearStyle={width:24,height:24,top:0,right:0,color:"#000000"},this.containerStyle={top:0,left:0},this.iconClearStyle=Object.assign(this.iconClearStyle,this.options.iconClearStyle),this.containerStyle=Object.assign(this.containerStyle,this.options.containerStyle),this.options.input instanceof Node?this.elSearchInput=this.options.input:this.elSearchInput=document.querySelector(this.options.input),this.elContainer=document.createElement("div"),this.elContainer.className=this.options.containerClass+" hide",this.elSearchInput.parentNode.insertBefore(this.elContainer,this.elSearchInput.nextSibling),this.elClearInput=document.createElement("i"),this.elClearInput.className=this.options.iconClearClass+" hide";const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","svg-clear"),e.setAttribute("viewBox","0 0 1024 1024"),e.setAttribute("version","1.1"),e.setAttribute("width",this.iconClearStyle.width),e.setAttribute("height",this.iconClearStyle.height);const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","M810.666667 273.493333L750.506667 213.333333 512 451.84 273.493333 213.333333 213.333333 273.493333 451.84 512 213.333333 750.506667 273.493333 810.666667 512 572.16 750.506667 810.666667 810.666667 750.506667 572.16 512z"),i.setAttribute("fill",this.iconClearStyle.color),e.appendChild(i),this.elClearInput.appendChild(e),this.elSearchInput.parentNode.insertBefore(this.elClearInput,this.elSearchInput.nextSibling),this.setPosition(),this.itemTemplate=document.createElement("div"),this.itemTemplate.setAttribute("class",this.options.itemClass),this.itemList=[],this.isKeydown=!1,this.timeout=null,this.isMousedown=!1}init(){this.elClearInput.addEventListener("click",(()=>{this._clear(),this.options.onClickClear()})),this.bindAutoComplete()}setPosition(){this.inputClientRect=this.elSearchInput.getBoundingClientRect(),this.elContainer.style.position="fixed",this.elContainer.style.width=this.inputClientRect.width+"px",this.elContainer.style.left=this.inputClientRect.left+this.containerStyle.left+"px",this.elContainer.style.top=this.inputClientRect.bottom+this.containerStyle.top+"px",this.elClearInput.style.position="fixed",this.elClearInput.style.left=this.inputClientRect.right-this.iconClearStyle.width-this.iconClearStyle.right+"px",this.elClearInput.style.top=this.inputClientRect.top+this.iconClearStyle.top+"px"}bindAutoComplete(){this.elSearchInput.addEventListener("blur",(t=>{this.isMousedown?this.isMousedown=!1:this.overlay(!1)})),this.elSearchInput.addEventListener("focus",(t=>{this.setPosition(),this.itemList.length>0&&this.overlay(!0)})),this.elSearchInput.addEventListener("keydown",(t=>{let e=this._trim(this.elSearchInput.value);if(e||this._clear(),this.oldVal=e,13!=t.keyCode)this.isKeydown=!0;else{const t=this.elContainer.querySelector("."+this.options.itemClass+".active");if(t)return t.dispatchEvent(new MouseEvent("mousedown",{button:0})),!0}38==t.keyCode&&t.preventDefault()})),this.elSearchInput.addEventListener("keyup",(t=>{if(!this.isKeydown)return;this.isKeydown=!1;try{switch(t.keyCode){case 27:return this.elSearchInput.value="",void this.overlay(!1);case 38:return this._prevSelected();case 40:return this._nextSelected()}}catch(t){console.log(t)}let e=this._trim(this.elSearchInput.value);if(!e)return void this._clear();if(this.oldVal==e)return;this.elClearInput.classList.remove("hide"),this.overlay(!0),this.options.onRequst(e);const i=new s.Z;this.options.requestParamsKey&&(this.options.requestParams[this.options.requestParamsKey]=e),clearTimeout(this.timeout),this.timeout=setTimeout((()=>{i.get(this.options.requestUri,this.options.requestParams).then((t=>{if(!this._trim(this.elSearchInput.value))return void this._clear();for(;this.elContainer.firstChild;)this.elContainer.removeChild(this.elContainer.firstChild);this.itemList=[];let e=t=this.options.parseRes(t),i=0;for(let t in e){let s={id:i++,title:e[t],val:t},n=this.options.parseItem(e[t]);n&&(s=Object.assign(s,n)),this.itemList.push(s);const l=this.addItemElement(s);this.options.firstSelected&&1==i&&l.classList.add("active")}0==this.itemList.length?this.elSearchInput.classList.remove("on"):this.elSearchInput.classList.add("on")}))}),this.options.delay)}))}addItemElement(t){const e=this.itemTemplate.cloneNode(!0);return e.textContent=t.title,e.setAttribute("data-i",t.id),e.setAttribute("data-title",t.title),e.setAttribute("title",t.title),e.addEventListener("mousedown",(e=>{if(this.isMousedown=!0,0===e.button)return this.overlay(!1),this.elSearchInput.value=t.title,this.options.onClick(t.title,t),!1})),this.elContainer.append(e),e}_prevSelected(){if(""==this._trim(this.elSearchInput.value))return;let t=this.itemList.length;const e=this.elContainer.querySelectorAll("."+this.options.itemClass),i=this.elContainer.querySelector("."+this.options.itemClass+".active"),s=e.item(0);let n=null;if(i&&i!=s){const e=Math.min(parseInt(i.getAttribute("data-i"))-1,t);n=this.elContainer.querySelector("."+this.options.itemClass+'[data-i="'+e+'"]'),this._scrollElement(n,this.elContainer)}else n=e.item(e.length-1),this.elContainer.scrollTo(0,n.offsetTop);return i&&i.classList.remove("active"),n.classList.add("active"),this.elSearchInput.value=n.getAttribute("data-title"),!1}_nextSelected(){if(""==this._trim(this.elSearchInput.value))return;let t=this.itemList.length;const e=this.elContainer.querySelectorAll("."+this.options.itemClass),i=this.elContainer.querySelector("."+this.options.itemClass+".active"),s=e.item(e.length-1);let n=null;if(i&&i!=s){const e=Math.min(parseInt(i.getAttribute("data-i"))+1,t);n=this.elContainer.querySelector("."+this.options.itemClass+'[data-i="'+e+'"]'),this._scrollElement(n,this.elContainer)}else n=e.item(0),this.elContainer.scrollTo(0,n.offsetTop);i&&i.classList.remove("active"),n.classList.add("active"),this.elSearchInput.value=n.getAttribute("data-title")}_scrollElement(t,e){const i=e.getBoundingClientRect();let s=i.bottom,n=i.top;const l=t.getBoundingClientRect();let o=l.bottom,a=l.top;o>s&&(e.scrollTop+=o-s),a<n&&(e.scrollTop-=n-a)}overlay(t){t?(this.itemList.length>0&&this.elSearchInput.classList.add("on"),this.elContainer.classList.remove("hide")):(this.elSearchInput.classList.remove("on"),this.elContainer.classList.add("hide"))}_clear(){this.overlay(!1),this.elContainer.classList.add("hide"),this.itemList=[],this.elClearInput.classList.add("hide"),this.elSearchInput.value="",this.elSearchInput.classList.remove("on")}_trim(t){return t.replace(/^\s+|\s+$/g,"")}}}}]);