var clientversion="1.0.0.0";var naclEnabled,base64EncodeChars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";if("undefined"==typeof MsgTag)var MsgTag={Audio:0,Command:1,Video:2,Heartbeat:3};
function base64encode(a){var b,c,d,f,e,g;d=a.length;c=0;for(b="";c<d;){f=a.charCodeAt(c++)&255;if(c==d){b+=base64EncodeChars.charAt(f>>2);b+=base64EncodeChars.charAt((f&3)<<4);b+="==";break}e=a.charCodeAt(c++);if(c==d){b+=base64EncodeChars.charAt(f>>2);b+=base64EncodeChars.charAt((f&3)<<4|(e&240)>>4);b+=base64EncodeChars.charAt((e&15)<<2);b+="=";break}g=a.charCodeAt(c++);b+=base64EncodeChars.charAt(f>>2);b+=base64EncodeChars.charAt((f&3)<<4|(e&240)>>4);b+=base64EncodeChars.charAt((e&15)<<2|(g&192)>>
6);b+=base64EncodeChars.charAt(g&63)}return b}var base64DecodeChars=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];
function base64decode(a){var b,c,d,f,e;f=a.length;d=0;for(e="";d<f;){do b=base64DecodeChars[a.charCodeAt(d++)&255];while(d<f&&-1==b);if(-1==b)break;do c=base64DecodeChars[a.charCodeAt(d++)&255];while(d<f&&-1==c);if(-1==c)break;e+=String.fromCharCode(b<<2|(c&48)>>4);do{b=a.charCodeAt(d++)&255;if(61==b)return e;b=base64DecodeChars[b]}while(d<f&&-1==b);if(-1==b)break;e+=String.fromCharCode((c&15)<<4|(b&60)>>2);do{c=a.charCodeAt(d++)&255;if(61==c)return e;c=base64DecodeChars[c]}while(d<f&&-1==c);if(-1==
c)break;e+=String.fromCharCode((b&3)<<6|c)}return e}function getAppName(){var a=navigator.userAgent.toLowerCase();return a.match(/msie ([\d.]+)/)?"Microsoft IE":a.match(/firefox\/([\d.]+)/)?"Mozilla Firefox":a.match(/chrome\/([\d.]+)/)?a.match(/cros/)?"Google Chrome OS":"Google Chrome":a.match(/opera.*version.([\d.]+)/)?"Opera":a.match(/version\/([\d.]+).*safari/)?"Apple Safari":a.match(/version\/([\d.]+).*mobile\/([\d.]+).*safari/)?"Mobile Safari":"Unknown Browser"}
function getPlatform(){var a=navigator.platform.toLowerCase();if(a.match(/^win/))return navigator.appVersion.toLowerCase().match(/windows nt 6\.2/)?"win8":"win";if(a.match(/^linux/))return"linux";if(a.match(/^mac/))return"mac"}
function getAppVersion(){var a=navigator.userAgent.toLowerCase(),b;return(b=a.match(/msie ([\d.]+)/))?b[1]:(b=a.match(/firefox\/([\d.]+)/))?b[1]:(b=a.match(/chrome\/([\d.]+)/))?b[1]:(b=a.match(/opera.*version.([\d.]+)/))?b[1]:(b=a.match(/version\/([\d.]+).*safari/))?b[1]:(b=a.match(/version\/([\d.]+).*mobile\/([\d.]+).*safari/))?b[1]:"0.0"}
function getPlatformVersion(){var a="Unknown OS",b=getAppVersion();if(isCrOS())a="chromoebook "+b;else{var c=navigator.platform.toLowerCase();if(c.match(/^win/))a=navigator.appVersion.toLowerCase(),a=a.match(/windows nt 6\.2/)?"window 8":a.match(/windows nt 6\.1/)?"window 7":"window";else{if(c.match(/^linux/))return"linux";if(c.match(/^mac/))return"osx"}a+="(chrome "+b+")"}return a}
function isCrOS(){var a=!1,b=navigator.appVersion;b&&(b=b.split(") ")[0])&&1<b.length&&(b=b.split("; ")[1])&&1<b.length&&(b=b.split(" ")[0])&&"CrOS"==b&&(a=!0);return a}
function isNaclEnabled(){naclEnabled=naclEnabled||!1;if(!naclEnabled){var a=document.createElement("embed");a.setAttribute("type","application/x-nacl");a.setAttribute("width",0);a.setAttribute("height",0);a.setAttribute("src","../nacl/videoview.nmf");document.body.appendChild(a);"undefined"!=typeof a.postMessage&&(naclEnabled=!0);document.body.removeChild(a)}return naclEnabled}
function checkBrowserWS(){var a={},b=navigator.userAgent.toLowerCase(),c;(c=b.match(/msie ([\d.]+)/))?a.ie=c[1]:(c=b.match(/firefox\/([\d.]+)/))?a.firefox=c[1]:(c=b.match(/chrome\/([\d.]+)/))?a.chrome=c[1]:(c=b.match(/opera.*version.([\d.]+)/))?a.opera=c[1]:(c=b.match(/version\/([\d.]+).*safari/))?a.safari=c[1]:(c=b.match(/version\/([\d.]+).*mobile\/([\d.]+).*safari/))?a.msafari=c[1]:a={};a.msafari&&(a.safari=null);return a.firefox&&(b=a.firefox.split("."),b=b[0],6<=parseInt(b,10))||a.chrome&&(b=
a.chrome.split("."),b=b[0],14<=parseInt(b,10))?!0:a.safari&&(b=a.safari.split("."),b=b[0],5<=parseInt(b,10))?!1:a.ie&&(b=a.ie.split(".")[0],10<=parseInt(b,10))||a.opera&&(b=parseInt(a.opera.split(".")[0],10),a=parseInt(a.opera.split(".")[1],10),12<b||12==b&&10<=a)?!0:!1}
function compareVersion(a,b){try{var c=a.split("."),d=b.split("."),f=c.length;f>d.length&&(f=d.length);for(var e=0;e<f;e++){if(parseInt(c[e])>parseInt(d[e]))return 1;if(parseInt(c[e])<parseInt(d[e]))return-1;if(e==f-1)return c.length>d.length?1:c.length<d.length?-1:0}}catch(g){return-2}}
function parseUrl(a,b){a||(a=location.search);if(!a||""==a||"?"==a)return null;var c,d=[];c=a.split("?")[1];if(!c)return null;if(b){for(var f=c.split("&"),e=0;e<f.length;e++){var g=f[e].split("=");"key"==g[0]?c=g[1]:d[g[0]]=1<g.length?g[1]:null}c=decodeURIComponent(base64decode(c))}c=c.split("&");for(e=0;e<c.length;e++)g=c[e].split("="),d[g[0]]=1<g.length?g[1]:null;return d}
function genUUID(a,b){var c=[],d,f="0123456789abcdefghijklmnopqrstuvwxyz".split("");a=a||32;6>a&&(a=32);b=b||f.length;b>f.length&&(b=f.length);for(d=0;d<a;d++)c[d]=f[0|parseInt(Math.random()*b)];return c.join("")}function getUUID(){var a=location.host+"/connect.html",b=storageGet(a);b&&""!=b||(b=genUUID(32,16),storageSet(a,b));return b}function setConnectURI(a){storageSet("connectURI",a)}function getConnectURI(){return storageGet("connectURI")}
function setConnectState(a){return storageSet("connectResult",a)}function getConnectState(){return storageGet("connectResult")}function setSessionConnecting(){setConnectState(1)}function setSessionConnectFail(){setConnectState(-1)}function setSessionConnectSucc(){setConnectState(0)}function sessionConnecting(){return 1==getConnectState()?!0:!1}function sessionFailed(){return-1==getConnectState()?!0:!1}function sessionConnected(){return 0==getConnectState()?!0:!1};var singal_server_addr="wss://wbs.relay.splashtop.com",extid_receiver="gjchibeaaphfidcocagddaebmbiondki",extid_sender="bnonegmlejfmmbiifekcakemjeeeoaim",m360_native_app_name="com.crestron.airmedia.native",config_oem="splashtop",config_uuid="bc75c746-6e64-3a54-a5ba-1b0983df9125",websocket_sub_protocol="com.splashtop.webrtc2",wbsserver_api_version="0.5";var p=null,storageGet=function(a){return p},storageSet=function(a,b){return p},storageRemove=function(a){return p},storageClear=function(){return p},storageInit=function(){return p},storageInited=!1;
if(chrome&&chrome.app.window&&chrome.storage&&chrome.storage.local){var w=chrome.app.window.current.parentwindow;w||(console.log("reget window"),w=chrome.app.window.current,w.s={});w.s||(console.log("Redefine w.s"),w.s={});try{chrome.storage.local.get(p,function(a){storageInited=!0;w.s=a})}catch(e$$13){console.log("chrome storage error!")}storageInit=function(){try{chrome.storage.onChanged.addListener(function(a,c){for(k in a)w.s[k]=a[k].newValue})}catch(a){console.log("chrome storage error!")}};
storageGet=function(a,b){var c=null;a in w.s&&(c=w.s[a]);if(b)if(storageInited)b(c);else{storageInit();try{chrome.storage.local.get(a,function(c){storageInited=!0;c&&(w.s=c,b(c[a]))})}catch(d){console.log("chrome storage error!"),b(c)}}return c};storageSet=function(a,b){w.s[a]=b;var c={};c[a]=b;chrome.storage.local.set(c)};storageRemove=function(a){w.s[a]=p;chrome.storage.local.remove(a)};storageClear=function(){w.s={};chrome.storage.local.clear()}}else window.localStorage&&(storageGet=function(a){return window.localStorage.getItem(a)},
storageSet=function(a,b){window.localStorage.setItem(a,b);storageGet(a)},storageRemove=function(a){window.localStorage.removeItem(a)},storageClear=function(){window.localStorage.clear()});Array.prototype.push||(Array.prototype.push=function(){for(var a=0,b=arguments.length;a<b;a++)this[this.length]=arguments[a];return this.length});Array.prototype.shift||(Array.prototype.shift=function(){if(0<this.length){for(var a=this[0],b=0,c=this.length-1;b<c;b++)this[b]=this[b+1];this.length-=1;return a}});
Array.prototype.splice||(Array.prototype.splice=function(a,b){var c=this.slice(a+b),d=this.slice(a,a+b);this.length=a;for(var f=[],e=0,g=arguments.length;e<g;e++)f[e]=arguments[e];c=2<f.length?f.slice(2).concat(c):c;e=0;for(g=c.length;e<g;e++)this.push(c[e]);return d});function getCallStack(){var a=[];try{call.doesnt.method+=1}catch(b){for(var c=b.stack?b.stack.split("\n"):b.message?b.message.split("\n"):[],d=0;d<c.length;d++)c[d].match(/^\s*at.*/)&&a.push(c[d])}return a}
function getFunctionName(a){var b="System call";(a=a.split(" ("))&&1<a.length&&(a=a[0].split(" at "))&&1<a.length&&(b=a[1]);return b}function getFileName(a){var b="";0<a.indexOf("?")&&(a=a.split("?")[0]);(a=a.split("/"))&&1<a.length&&(a=a[a.length-1],0<a.indexOf(":")?(a=a.split(":"))&&1<a.length&&(b=a[0]):b=a);return b}function getLine(a){var b=0;(a=a.split("/"))&&1<a.length&&(a=a[a.length-1].split(":"))&&1<a.length&&(b=a[1]);return b}function getCallLine(a){return 4<a.length?a[4]:""}
var log4splashtop=function(){function a(a,b){void 0===b&&(b=a,a=new Date);var c={M:a.getMonth()+1,d:a.getDate(),h:a.getHours(),m:a.getMinutes(),s:a.getSeconds(),q:Math.floor((a.getMonth()+3)/3)};return b=b.replace(/([yMdhmsqS])+/g,function(b,d){var m=c[d];return void 0!==m?(1<b.length&&(m="0"+m,m=m.substr(m.length-2)),m):"S"===d?a.getMilliseconds():"y"===d?(a.getFullYear()+"").substr(4-b.length):b})}function b(b,c,d,e){this.time=b;this.level=c;this.name=d;this.message=e;var f=getCallStack(),g=getCallLine(f);
this.format=function(){for(var b="",c=0;c<this.message.length;c++)b+=a(this.time,"yyyy-MM-dd hh:mm:ss:SSS")+" "+this.level.toString()+" ("+getFileName(g)+":"+getFunctionName(g)+":"+getLine(g)+") "+this.message[c];return b};this.trace=function(){for(var b=a(this.time,"yyyy-MM-dd hh:mm:ss:SSS")+" "+this.level.toString()+" ("+getFileName(g)+":"+getFunctionName(g)+":"+getLine(g)+") "+this.message+"\n",c=4;c<f.length;c++)b+=f[c]+"\n";return b}}function c(a){this.getMessages=function(){return l};this.name=
a;storageGet("savedlogcount")&&(f=parseInt(storageGet("savedlogcount")));this.setLogLevel=function(a){storageSet("loglevel",a);a=a.toLowerCase();"debug"==a?e=d.DEBUG:"trace"==a?e=d.TRACE:"info"==a?e=d.INFO:"warn"==a?e=d.WARN:"error"==a&&(e=d.ERROR)};this.log=function(a,c){if(a.isGreaterOrEqual(e)){var d=new b(new Date,a,this.name,c);l[l.length]=d;if(!0===q){var f="";storageGet(h)&&(f=storageGet(h));f+=d.format();storageSet(h,f+"\n")}"undefined"!=typeof console&&console.log(d.format())}};this.dump=
function(a){a=new b(new Date,d.TRACE,this.name,a);l[l.length]=a;var c="";storageGet(h)&&(c=storageGet(h));c+=a.trace();storageSet(h,c)};this.printLog=function(){if(console&&l)for(var a=0;a<l.length;a++)for(var b=l[a],c=0;c<b.length;c++)console.log(b[c].format())};this.startNewLog=function(){this.bLog(g)};this.initStorage=function(){storageGet(h)||storageSet(h,"");var a=storageGet(h);if(a&&""!=a){var b=a.split(g);if(!(b.length<=f)){for(var a=[],c=b.length-f;c<b.length;c++)a.push(b[c]);a=g+a.join(g)}a+=
g}else a=g;storageSet(h,a)};this.save=function(){if(storageGet(h)){for(var a=storageGet(h),b=0;b<l.length;b++)a+=l[b].format();storageSet(h,a);l.clear()}};this.clear=function(){storageRemove(h);l.clear()};this.resetStorage=function(){this.initStorage()};this.setLevel=function(a){loggerLevel=a};this.getLevel=function(){return loggerLevel};this.toString=function(){return"Logger["+this.name+"]"};this.SaveToStorage=function(a){q=a}}var d=function(a,b){this.level=a;this.name=b};d.prototype={toString:function(){return this.name},
equals:function(a){return this.level==a.level},isGreaterOrEqual:function(a){return this.level>=a.level}};d.TRACE=new d(1E4,"TRACE");d.DEBUG=new d(2E4,"DEBUG");d.INFO=new d(3E4,"INFO");d.WARN=new d(4E4,"WARN");d.ERROR=new d(5E4,"ERROR");d.LOG=new d(6E4,"LOG");var f=1,e=d.INFO,g="***START A NEW SESSION LOG***\n",h="Splashtop_saved_log",q=!1,n={},r=[],l=[];(function(a){var b={};a.replace(/(\w+)=(\w+)/ig,function(a,c,d){b[c]=d});return b})(location.href);c.prototype={trace:function(){this.log(d.TRACE,
arguments)},debug:function(){this.log(d.DEBUG,arguments)},info:function(){this.log(d.INFO,arguments)},warn:function(){this.log(d.WARN,arguments)},error:function(){this.log(d.ERROR,arguments)},bLog:function(){this.log(d.LOG,arguments)}};log4splashtop=function(){};log4splashtop.getLogger=function(a){a||(a="Splashtop_default_logger_name");if(!n[a]){var b=new c(a);n[a]=b;r.push(a)}return n[a]};log4splashtop.printLog=function(){var a=storageGet(h);console&&a&&console.log(a)};return window.log4splashtop=
log4splashtop}();window.log=window.log||log4splashtop.getLogger();var l18n=l18n||{};
l18n.dotranslation=function(){$(".need_l18n").each(function(a,b){$(b).text(chrome.i18n.getMessage($(b).attr("id")))});$(".need_l18n_raw_html").each(function(a,b){$(b).html(chrome.i18n.getMessage($(b).attr("id")))});$(".need_l18n_input").each(function(a,b){$(b).val(chrome.i18n.getMessage($(b).attr("id")))});$(".need_l18n_title").each(function(a,b){document.title=chrome.i18n.getMessage($(b).attr("id"))});$(".need_l18n_placeholder").each(function(a,b){});$(".need_l18n_style").each(function(a,b){if(chrome.i18n.getMessage($(b).attr("id")+
"_styles")){var c=chrome.i18n.getMessage($(b).attr("id")+"_styles").split(";");for(a in c){var d=c[a].replace(/(^\s*)|(\s*$)/g,"").split(":");1<d.length&&(b.style[d[0]]=d[1])}}})};var mir_desk=null,mir_tab=null,mir_tab_id=0,currentSelect=1,wbs=null,oem=null,main_page=null,page_connect=null,feature={},first_attempt_at_auth=!1,ConnectState={CSInit:0,CSConnected:1,CSConnecting:2,CSStoped:3,CSError:-1,CSClosed:-2,CSUnknow:-3},currentstatus=ConnectState.CSInit,s_idx_ip="ams_stg_ip",s_idx_sel="ams_stg_sel";window.sendExtMessage=function(a,b){chrome.runtime.sendMessage({type:"splashtop.m360.ext.request.message",msg:a},function(a){b&&b(a)})};
var setUIConnectResult=function(a){if(main_page){$("#inp_pincode-helper-text").removeClass("mdc-text-field-helper-text--persistent");switch(a){case -2:main_page.attr("class","main_error");break;case 0:main_page.attr("class","main_page");break;case 200:main_page.attr("class","main_succ");break;case 401:main_page.attr("class","main_auth");""!=$("#inp_pincode").val()&&$("#inp_pincode-helper-text").addClass("mdc-text-field-helper-text--persistent");break;case 404:main_page.attr("class","main_error");
break;case 400:main_page.attr("class","main_page")}updateUIElements()}else console.error("Not init?")};chrome.runtime.onMessage.addListener(function(a,b,c){a&&"splashtop.m360.bg.request.message"==a.type?a.msg&&"connectresult"==a.msg.id&&setUIConnectResult(a.msg.code):(console.log("Not bg message!"),c&&c(0))});window.setCurrentSelect=function(a){currentSelect=a;storageSet("CaptureCurrentSelect",a)};
window.getCurrentSelect=function(){currentSelect=storageGet("CaptureCurrentSelect");if(null==currentSelect||1>currentSelect)currentSelect=1;return currentSelect};window.connectServer=function(a){var b="session=",b={id:"shareTo",name:a.name,code:a.scode,sel:getCurrentSelect(),mir_tab_id:mir_tab_id};a.wbs&&(b.wbs=a.wbs);sendExtMessage(b,function(a){})};
window.disconnectServer=function(a){a&&"undefined"!=typeof a.scode&&sendExtMessage({id:"disconnectServer",code:a.scode},function(a){try{log&&log.debug("disconnectServer: "+JSON.stringify(a))}catch(c){}})};var resetPage=function(){var a=document.getElementById("main_page");a&&(a.style.height="100%")};window.onbeforeunload=function(){sendExtMessage({id:"actionclose"},function(a){})};
var doConnect=function(){if(!main_page.hasClass("main_process")){$("#inp_pincode").val("");var a=$("#inp_connect").val();storageSet(s_idx_ip,a);setCurrentSelect($("input[name='rd_mir_sel']:checked").val());""==a?(page_connect.addClass("par_error"),$("#inp_connect").focus()):(page_connect.removeClass("par_error"),main_page.attr("class","main_process"),connectServer({name:"AirMedia Chrome Sender",scode:a}),updateUIElements())}},doStop=function(){main_page.attr("class","main_process");sendExtMessage({id:"stop"},
function(a){main_page.attr("class","main_page");updateUIElements()})},doRetry=function(){main_page.attr("class","main_process");sendExtMessage({id:"retry"},function(a){})},doAuth=function(){var a=$("#inp_pincode").val();a&&""!=a?sendExtMessage({id:"auth",code:a},function(a){main_page.attr("class","main_process")}):$("#inp_pincode").focus()},doCancel=function(a){main_page.attr("class","main_page");sendExtMessage({id:"cancel",type:a},function(a){})},elementOps={ip:{enable:function(){$("#inp_connect").attr("disabled",
!1);$(".crestron-page-connect .mdc-text-field").removeClass("mdc-text-field--disabled")},disable:function(){$("#inp_connect").attr("disabled",!0);$(".crestron-page-connect .mdc-text-field").addClass("mdc-text-field--disabled")}},capture:{enable:function(){$("input[type=radio]").attr("disabled",!1)},disable:function(){$("input[type=radio]").attr("disabled",!0)}},auth_error:{show:function(){first_attempt_at_auth?$("#inp_pincode_helper_text").addClass("mdc-text-field-helper-text--persistent"):(first_attempt_at_auth=
!0,$("#inp_pincode_helper_text").removeClass("mdc-text-field-helper-text--persistent"))},hide:function(){first_attempt_at_auth=!1;$("#inp_pincode_helper_text").removeClass("mdc-text-field-helper-text--persistent")}}},updateUIElements=function(){main_page.hasClass("main_page")?(elementOps.capture.enable(),elementOps.ip.enable(),elementOps.auth_error.hide()):main_page.hasClass("main_succ")?(elementOps.capture.disable(),elementOps.ip.disable(),elementOps.auth_error.hide()):main_page.hasClass("main_process")?
(elementOps.capture.disable(),elementOps.ip.disable(),elementOps.auth_error.hide()):main_page.hasClass("main_fail")?(elementOps.capture.enable(),elementOps.ip.enable(),elementOps.auth_error.hide()):main_page.hasClass("main_auth")?(elementOps.capture.disable(),elementOps.ip.disable(),$("#inp_pincode").focus(),elementOps.auth_error.show()):main_page.hasClass("main_error")&&(elementOps.capture.enable(),elementOps.ip.enable(),elementOps.auth_error.hide())},onBtnClick=function(a){switch(a.target.getAttribute("id")){case "btn_ok":doAuth();
break;case "btn_connect":doConnect();break;case "btn_cancel":doCancel("connect");break;case "btn_stop":doStop();break;case "btn_auth_cancel":doCancel("auth");break;case "btn_retry":doRetry();break;case "btn_retry_cancel":doCancel("retry")}updateUIElements();a.stopPropagation();a.preventDefault()};
window.onload=function(){storageInit();sendExtMessage({id:"currentstatus"},function(a){currentstatus=a;main_page=$("#main_page");page_connect=$("#page_connect");a="input[value="+getCurrentSelect()+"]";$(a)[0].checked=!0;a=storageGet(s_idx_ip);$("#inp_connect").val(a);$("button").on("click",onBtnClick);$("#inp_connect").on("keydown",function(a){13==a.keyCode&&(doConnect(),a.stopPropagation(),a.preventDefault())});$("#inp_pincode").on("keydown",function(a){13==a.keyCode&&(doAuth(),a.stopPropagation(),
a.preventDefault())});l18n.dotranslation();a=parseUrl();if(currentstatus==ConnectState.CSConnecting)a&&"auth"==a.connectresult?main_page.attr("class","main_auth"):main_page.attr("class","main_process");else if(currentstatus==ConnectState.CSError)main_page.attr("class","main_error");else if(currentstatus==ConnectState.CSConnected)main_page.attr("class","main_succ");else{if(!a)return;switch(a.connectresult){case "succ":main_page.attr("class","main_succ");break;case "auth":main_page.attr("class","main_auth");
break;case "error":main_page.attr("class","main_error");break;case "process":main_page.attr("class","main_process")}}updateUIElements()})};
