var runtimePort=chrome.runtime.connect({name:location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join("")}),config={apiKey:"AIzaSyCIgzrQZmZjWa9N9H_Wuaag7XRSqv8NH4g",authDomain:"outclip-3e4dc.firebaseapp.com",databaseURL:"https://outclip-3e4dc.firebaseio.com",projectId:"outclip-3e4dc"},username="";function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}firebase.initializeApp(config),firebase.auth().onAuthStateChanged(function(e){e&&localStorage.getItem("uid")?(firebase.database().ref().child("userinfo").child(localStorage.getItem("uid")).once("value",e=>{var t="";(e.exists()&&(e.child("profilephotourl").exists()&&(t=e.child("profilephotourl").val()),e.child("displayname").exists()&&(username=e.child("displayname").val())),localStorage.getItem("workspaceid"))?firebase.database().ref().child("workspaces").child(localStorage.getItem("workspaceid")).child("customer").orderByKey().limitToLast(1).once("value",e=>{e.exists()?firebase.database().ref().child("videocredits").child(localStorage.getItem("workspaceid")).once("value",a=>{var o=0,r=0;a.child("totalcredits").exists()&&(o=Number(a.val().totalcredits)),a.child("creditsused").exists()&&(r=Number(a.val().creditsused)),e.forEach(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:e.val().type,subscriptionStartDate:e.val().createdon,numCredits:o-r,profilePhotoURL:t,username:username})})}).catch(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}):runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}).catch(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username}),console.log(e)}):runtimePort.postMessage({userIsLoggedIn:"false",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}),firebase.database().ref().child("userinfo").child(localStorage.getItem("uid")).child("profilephotourl").on("value",function(e){runtimePort.postMessage({updateProfilePhoto:"true",profilePhotoURL:e.val()})})):runtimePort.postMessage({userIsLoggedIn:"false",customerType:"limited",numCredits:0})}),firebase.auth().onIdTokenChanged(function(e){e&&localStorage.getItem("workspaceid")&&e.getIdToken(!1).then(e=>{runtimePort.postMessage({idtokenChanged:"true",idtoken:e})})}),window.addEventListener("message",function(e){if(e.source==window.top)if(e.data.type&&"CHECK_USER_LOGIN_STATUS"==e.data.type)var t=firebase.auth().onAuthStateChanged(function(e){(t(),e&&localStorage.getItem("uid"))?firebase.database().ref().child("userinfo").child(localStorage.getItem("uid")).once("value",e=>{var t="";(e.exists()&&(e.child("profilephotourl").exists()&&(t=e.child("profilephotourl").val()),e.child("displayname").exists()&&(username=e.child("displayname").val())),localStorage.getItem("workspaceid"))?firebase.database().ref().child("workspaces").child(localStorage.getItem("workspaceid")).child("customer").orderByKey().limitToLast(1).once("value",e=>{e.exists()?firebase.database().ref().child("videocredits").child(localStorage.getItem("workspaceid")).once("value",a=>{var o=0,r=0;a.child("totalcredits").exists()&&(o=Number(a.val().totalcredits)),a.child("creditsused").exists()&&(r=Number(a.val().creditsused)),e.forEach(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:e.val().type,subscriptionStartDate:e.val().createdon,numCredits:o-r,profilePhotoURL:t,username:username})})}).catch(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}):runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}).catch(e=>{runtimePort.postMessage({userIsLoggedIn:"true",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username}),console.log(e)}):runtimePort.postMessage({userIsLoggedIn:"false",customerType:"limited",numCredits:0,profilePhotoURL:t,username:username})}):runtimePort.postMessage({userIsLoggedIn:"false",customerType:"limited",numCredits:0})});else if(e.data.type&&"CREATE_NEW_POST"==e.data.type)var a=firebase.auth().onAuthStateChanged(function(e){a(),e&&e.getIdTokenResult(!1).then(e=>{var t=firebase.database().ref().child("groupvideos").child(localStorage.getItem("workspaceid")).child(localStorage.getItem("defaultgroupid")).push(),a=firebase.database().ref().child("sharedvideos").push();t.set({uid:localStorage.getItem("uid"),chromeextensionversion:chrome.runtime.getManifest().version,createdon:firebase.database.ServerValue.TIMESTAMP}).then(()=>{a.set({wid:localStorage.getItem("workspaceid"),gid:localStorage.getItem("defaultgroupid"),vid:t.key,uid:localStorage.getItem("uid")}).then(()=>{runtimePort.postMessage({createdNewPost:"true",idtoken:e.token,wid:localStorage.getItem("workspaceid"),gid:localStorage.getItem("defaultgroupid"),vid:t.key,uid:localStorage.getItem("uid"),shareid:a.key})})})})});else if(e.data.type&&"REPORT_ERROR"==e.data.type){(o={})[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/error`]=e.data.error,o[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/errorlog`]=e.data.errorlog,o[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/createdon`]=firebase.database.ServerValue.TIMESTAMP,o[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/durationInMs`]=e.data.durationInMs,firebase.database().ref().update(o).catch(e=>{console.log(e)})}else if(e.data.type&&"FINISH_POST"==e.data.type){firebase.database().ref().child("videocredits").child(localStorage.getItem("workspaceid")).once("value",t=>{var a=0,o=0;t.child("totalcredits").exists()&&(a=Number(t.val().totalcredits)),t.child("creditsused").exists()&&(o=Number(t.val().creditsused));var r=username&&username.split(" ").length>0?username.split(" ")[0]:null,i="OutKlip Video";r&&(i="A Video by "+capitalizeFirstLetter(r)),i+=" - "+moment().format("MMMM Do YYYY h:mm a");var s={};s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/createdon`]=firebase.database.ServerValue.TIMESTAMP,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/webmuri`]="https://content.checkoutclip.com/"+e.data.videoKey,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/shareid`]=e.data.shareid,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/videosource`]="screen",s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/durationInMs`]=e.data.durationInMs,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/shareenabled`]=!0,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/title`]=i,s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/description`]="Made with https://outklip.com",s[`/groupvideos/${localStorage.getItem("workspaceid")}/${localStorage.getItem("defaultgroupid")}/${e.data.videoid}/usescredit`]=a-o>0,s[`/sharedvideos/${e.data.shareid}/title`]=i,s[`/sharedvideos/${e.data.shareid}/description`]="Made with https://outklip.com",s[`/sharedvideos/${e.data.shareid}/createdon`]=firebase.database.ServerValue.TIMESTAMP,s[`/sharedvideos/${e.data.shareid}/durationInMs`]=e.data.durationInMs,s[`/sharedvideos/${e.data.shareid}/usescredit`]=a-o>0,s[`/sharedvideocomments/${e.data.shareid}/wid`]=localStorage.getItem("workspaceid"),s[`/sharedvideocomments/${e.data.shareid}/gid`]=localStorage.getItem("defaultgroupid"),s[`/sharedvideocomments/${e.data.shareid}/vid`]=e.data.videoid,s[`/usercontent/${localStorage.getItem("uid")}/videos/${e.data.shareid}`]=!0,firebase.database().ref().update(s).then(t=>{var a=firebase.database().ref().child("sharedvideos").child(e.data.shareid).child("webmuri");a.on("value",e=>{e.exists()&&(a.off(),runtimePort.postMessage({finishedPost:"true"}))})}).catch(e=>{console.log(e)})}).catch(e=>{console.log(e)})}else if(e.data.type&&"CREATE_NEW_INSTALL"==e.data.type){if(!(r=localStorage.getItem("installid"))){r=firebase.database().ref().child("installations").push().key;const e=localStorage.getItem("uid");var o={};const t=Intl.DateTimeFormat().resolvedOptions().timeZone;o[`/installations/${r}/createdon`]=firebase.database.ServerValue.TIMESTAMP,o[`/installations/${r}/timezone`]=t||"",e?o[`/installations/${r}/uid`]=e:localStorage.setItem("installid",r),firebase.database().ref().update(o)}}else if(e.data.type&&"FINISH_NONUSER_VIDEO"==e.data.type){var r;if(r=localStorage.getItem("installid")){(o={})[`/nonuservideos/${r}/${firebase.database().ref().child("nonuservideos").child(r).push().key}/createdon`]=firebase.database.ServerValue.TIMESTAMP,firebase.database().ref().update(o)}else{r=firebase.database().ref().child("installations").push().key,localStorage.setItem("installid",r);var o={};const e=Intl.DateTimeFormat().resolvedOptions().timeZone;o[`/nonuservideos/${r}/${firebase.database().ref().child("nonuservideos").child(r).push().key}/createdon`]=firebase.database.ServerValue.TIMESTAMP,o[`/installations/${r}/createdon`]=firebase.database.ServerValue.TIMESTAMP,o[`/installations/${r}/timezone`]=e||"",firebase.database().ref().update(o)}}},!1),runtimePort.postMessage({checkIfNewInstall:"true"});